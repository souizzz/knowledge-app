# 🧪 メール認証のテスト手順

## 🚀 テスト環境の準備

### 1. 開発環境でのテスト

#### **ローカル環境でのテスト**
```bash
# フロントエンドを起動
cd frontend
npm run dev

# ブラウザでアクセス
# http://localhost:3000/login
```

#### **テスト手順**
1. **ログインページにアクセス**
2. **メールアドレスを入力**
3. **「メールリンク / 6桁コードを送る」をクリック**
4. **メールボックスを確認**
5. **メールのリンクをクリック**
6. **認証が完了することを確認**

### 2. 本番環境でのテスト

#### **Vercelデプロイ後のテスト**
```bash
# デプロイURLにアクセス
# https://your-domain.vercel.app/login
```

#### **テスト手順**
1. **本番URLにアクセス**
2. **メールアドレスを入力**
3. **メール送信を実行**
4. **メールボックスを確認**
5. **認証フローを完了**

## 🔍 テスト項目

### 1. 基本機能テスト

#### **ログイン機能**
- [ ] メールアドレス入力
- [ ] メール送信
- [ ] メール受信
- [ ] リンククリック
- [ ] 認証完了
- [ ] リダイレクト

#### **招待機能**
- [ ] 招待URL生成
- [ ] 招待メール送信
- [ ] 招待メール受信
- [ ] 招待受諾
- [ ] 組織参加

### 2. エラーハンドリングテスト

#### **無効なメールアドレス**
- [ ] 形式チェック
- [ ] エラーメッセージ表示
- [ ] 送信防止

#### **メール送信エラー**
- [ ] ネットワークエラー
- [ ] SMTPエラー
- [ ] レート制限エラー

#### **認証エラー**
- [ ] 無効なトークン
- [ ] 期限切れトークン
- [ ] 重複使用

### 3. セキュリティテスト

#### **認証セキュリティ**
- [ ] トークンの有効期限
- [ ] ワンタイム使用
- [ ] セッション管理
- [ ] CSRF保護

#### **メールセキュリティ**
- [ ] スパム対策
- [ ] フィッシング対策
- [ ] 暗号化

## 📊 ログの確認

### 1. Supabaseログ

#### **認証ログの確認**
1. **Supabaseダッシュボード** → **Logs**
2. **Auth** カテゴリを選択
3. **認証イベント**を確認

#### **確認すべきログ**
- `sign_in_with_otp`
- `token_refreshed`
- `user_created`
- `user_updated`

### 2. Resendログ

#### **メール送信ログの確認**
1. **Resendダッシュボード** → **Logs**
2. **送信状況**を確認

#### **確認すべき情報**
- 送信数
- 配信率
- 開封率
- エラー率

### 3. Vercelログ

#### **アプリケーションログの確認**
1. **Vercelダッシュボード** → **Functions**
2. **ログ**を確認

#### **確認すべきログ**
- API呼び出し
- エラーメッセージ
- パフォーマンス

## 🚨 トラブルシューティング

### よくある問題と解決方法

#### メールが届かない
1. **スパムフォルダを確認**
2. **メールアドレスの確認**
3. **Resendのログを確認**
4. **SMTP設定を確認**

#### 認証が失敗する
1. **トークンの有効期限を確認**
2. **URLの確認**
3. **セッションの確認**
4. **ブラウザのキャッシュをクリア**

#### エラーメッセージが表示される
1. **エラーログを確認**
2. **設定を再確認**
3. **環境変数を確認**
4. **依存関係を確認**

## 📈 パフォーマンステスト

### 1. 負荷テスト

#### **同時接続テスト**
- 複数のユーザーで同時ログイン
- メール送信の負荷テスト
- データベースの負荷テスト

#### **レスポンス時間テスト**
- メール送信時間
- 認証完了時間
- ページ読み込み時間

### 2. 可用性テスト

#### **継続性テスト**
- 長時間の動作確認
- メモリリークの確認
- エラーハンドリングの確認

## ✅ テスト完了チェックリスト

### 基本機能
- [ ] ログイン機能が正常に動作
- [ ] 招待機能が正常に動作
- [ ] メール送信が正常に動作
- [ ] 認証フローが正常に動作

### エラーハンドリング
- [ ] 無効な入力の処理
- [ ] ネットワークエラーの処理
- [ ] 認証エラーの処理

### セキュリティ
- [ ] トークンの有効期限
- [ ] セッション管理
- [ ] CSRF保護

### パフォーマンス
- [ ] レスポンス時間
- [ ] 負荷テスト
- [ ] 可用性テスト

### ログとモニタリング
- [ ] ログの確認
- [ ] エラーの監視
- [ ] パフォーマンスの監視

## 🎯 本番環境での監視

### 1. メトリクスの設定
- メール送信数
- 認証成功率
- エラー率
- レスポンス時間

### 2. アラートの設定
- エラー率の閾値
- レスポンス時間の閾値
- メール送信失敗のアラート

### 3. ダッシュボードの作成
- リアルタイム監視
- 履歴データの表示
- トレンド分析

これで包括的なテストが完了し、本番環境での安定した動作が保証されます！
